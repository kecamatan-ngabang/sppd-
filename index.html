<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generator SPPD Kecamatan Ngabang</title>

 <!-- 🏛️ Favicon Pemerintah Kabupaten Landak -->
<link rel="icon" type="image/png" href="faviicon.png">

<style>
  /* Margin atas 2cm untuk surat & PDF */

#preview {
  background: white;
  border: none;         /* 🔥 hilangkan garis */
  padding: 50px;
  margin-top: 30px;
}


  @page { size: A4 portrait; margin: 2cm; }
  body { font-family: 'Times New Roman', Times, serif, sans-serif; background: #f5f7fa; margin: 0; padding: 30px; }
.container {
  max-width: 900px;
  margin: auto;
  background: #fff;
  border: none;         /* 🔥 hilangkan border & shadow */
  box-shadow: none;
  padding: 25px 40px;
}

  h2 { text-align: center; color: #0a3c85; font-size: 20px; margin-bottom: 20px; }
  label { font-weight: bold; display: block; margin-top: 10px; }
  input, textarea {
    width: 100%; padding: 6px 10px; border: 1px solid #bbb;
    border-radius: 5px; margin-top: 5px; font-size: 12pt;
  }
  button {
    margin-top: 12px; padding: 8px 18px; border: none;
    border-radius: 6px; background: #0a3c85; color: white; cursor: pointer;
  }
  button:hover { background: #052c6b; }
  #preview { background: white; border: 1px solid #ccc; padding: 50px; margin-top: 30px; }

  /* --- Style Kop Surat --- */
  .kop {
    text-align: center; position: relative;
    padding-bottom: 10px; margin-bottom: 10px;
    border: none;
  }
  .kop img {
    position: absolute;
    top: 0px;        /* jarak logo dari atas */
    left: 10px;
    width: 90px;      /* lebar logo */
    height: 100px;     /* tinggi logo */
  }
  .kop h2 { font-size: 14pt; margin: 0; font-weight: bold; margin-top: 30px; }
  .kop h1 { font-size: 16pt; margin: 0; font-weight: bold; }
  .kop p { font-size: 11pt; margin: 0; }
  .kop .ngabang { font-weight: bold; letter-spacing: 4px; font-size: 11pt; margin-bottom: 8px; }

.kop-line {
  position: relative;
  width: 93%;
  margin: 8px auto 0 auto;
  height: 7pt; /* total tinggi area dua garis */
  border: none;
}

/* Garis atas tipis */
.kop-line::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  border-top: 1.5pt solid black;
}

/* Garis bawah tebal, berjarak 1pt dari garis atas */
.kop-line::after {
  content: "";
  position: absolute;
  top: 2.5pt; /* jarak 1pt dari garis atas */
  left: 0;
  right: 0;
  border-top: 3.5pt solid black;
}


  .judul { text-align: center; margin-top: 20px; }
  .judul h3 {
    font-size: 14pt; font-weight: bold;
    text-decoration: underline;
    text-underline-offset: 3px;
    margin-bottom: 5px;
  }
  .judul p { font-size: 11pt; margin: 0; }

  /* 🔹 Spasi 1.15 untuk isi surat */
.isi-surat,
.isi-surat * {
  line-height: 1.15;
}

  .isi-surat table {
    width: 100%; margin-top: 15px; margin-bottom: 15px;
  }
  .isi-surat td {
    font-size: 12pt;
    vertical-align: top;
    padding: 2px 4px;
  }

  .tanda-tangan,
.tanda-tangan * {
  line-height: 1.15;
}

/* Jarak sejajar antar kolom isi data petugas */
.petugas-table {
  border-collapse: collapse;
  width: 100%;
  margin-left: 50px;
  table-layout: fixed; /* penting agar jarak stabil */
}

.petugas-table td {
  font-size: 12pt;
  vertical-align: top;
  padding: 2px 4px;
  white-space: nowrap;
}

/* kolom label seperti Nama, Pangkat/Gol */
.petugas-table td:nth-child(2) {
  width: 100px; /* label tetap */
}

/* Kolom titik dua */
.petugas-table td:nth-child(3) {
  width: 10px;
  text-align: left;
  padding-right: 5px; /* beri ruang kecil */
}

/* Kolom isi (setelah :) */
.petugas-table td:nth-child(4) {
  padding-left: 10px; /* 1 spasi = 10px */
  width: calc(100% - 160px);
}



  .tengah { text-align: center; margin: 30px 0 15px 0; }
  .tanda-tangan { text-align: right; margin-top: 50px; }

.tanda-tangan p:nth-child(3) {
  margin-bottom: 30px; /* jarak antar jabatan & nama camat */
}


  .underline { text-decoration: underline; text-underline-offset: 2px; }
</style>
</head>

<body>
<div class="container">
  <h>Surat  Perintah Tugas<br>Kecamatan Ngabang</h2>

  <label>Nomor Surat:</label>
  <input type="text" id="nomor" placeholder="Contoh: 094">
  <label>Tahun:</label>
  <input type="text" id="tahun" placeholder="Contoh: 2025">
  <label>Dasar Surat:</label>
  <textarea id="dasar" rows="3">Peraturan Bupati Landak Nomor 1 Tahun 2020 tentang Perjalanan Dinas Dalam Negeri Atas beban Anggaran Pendapatan dan Belanja Daerah Kabupaten Landak</textarea>
  <label>Keperluan:</label>
  <input type="text" id="keperluan" placeholder="Contoh: Menghadiri kegiatan pelatihan aparatur desa di Landak">
  <label>Tanggal Penetapan:</label>
  <input type="date" id="tanggal">

  <h3>Daftar Petugas</h3>
  <div id="petugasContainer"></div>
  <button type="button" onclick="tambahPetugas()">Tambah Petugas</button>

  <br><br>
  <button onclick="generatePreview()">Tampilkan Surat</button>

  <div id="preview"></div>

  <div id="exportButtons" style="display:none; text-align:center; margin-top:20px;">
    <button onclick="exportPDF()">Unduh PDF</button>
  </div>
</div>

<!-- Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
let petugasCount = 0;

function tambahPetugas() {
  petugasCount++;
  const div = document.createElement("div");
  div.classList.add("petugas");
  div.style.borderBottom = "1px dashed #ccc";
  div.style.marginBottom = "10px";
  div.innerHTML = `
    <label>Petugas ${petugasCount}</label>
    <input type="text" placeholder="Nama Lengkap" class="nama">
    <input type="text" placeholder="Pangkat/Gol" class="pangkat">
    <input type="text" placeholder="NIP" class="nip">
    <input type="text" placeholder="Jabatan" class="jabatan">
  `;
  document.getElementById("petugasContainer").appendChild(div);
}

function generatePreview() {
  const nomor = document.getElementById("nomor").value || "-";
  const tahun = document.getElementById("tahun").value || "-";
  const dasar = document.getElementById("dasar").value || "-";
  const keperluan = document.getElementById("keperluan").value || "-";
  const tanggalInput = document.getElementById("tanggal").value;
  const tanggal = tanggalInput ? new Date(tanggalInput) : new Date();
  const tglFormat = tanggal.toLocaleDateString("id-ID", { day: "numeric", month: "long", year: "numeric" });

  let petugasHTML = "";
  const petugas = document.querySelectorAll(".petugas");
  petugas.forEach((div, i) => {
    const nama = div.querySelector(".nama").value || "-";
    const pangkat = div.querySelector(".pangkat").value || "-";
    const nip = div.querySelector(".nip").value || "-";
    const jabatan = div.querySelector(".jabatan").value || "-";

   petugasHTML += `
  <table class="petugas-table">
    <tr>
      <td width="20px">${i + 1}.</td>
      <td>Nama</td><td>:</td><td>${nama}</td>
    </tr>
    <tr>
      <td></td><td>Pangkat/Gol</td><td>:</td><td>${pangkat}</td>
    </tr>
    <tr>
      <td></td><td>NIP</td><td>:</td><td>${nip}</td>
    </tr>
    <tr>
      <td></td><td>Jabatan</td><td>:</td><td>${jabatan}</td>
    </tr>
  </table><br>`;


  });

  document.getElementById("preview").innerHTML = `
    <div class="kop">
      <img src="logo.png" alt="Logo Kabupaten Landak">
      <h2>PEMERINTAH KABUPATEN LANDAK</h2>
      <h1>KECAMATAN NGABANG</h1>
      <p><i>Alamat : Jl. Gusti A. Rani Jalur II, Ngabang, Landak, Kalimantan Barat </i></p>
      <p><i>Laman : https://kecamatanngabang.landakkab.go.id</i></p>
      <p><i>kecamatanngabang8@gmail.com</i></p>
      <p><i>Kode Pos 79357</i></p>

      
      <div class="kop-line"></div>
    </div>

    <div class="judul">
      <h3 class="underline">SURAT PERINTAH TUGAS</h3>
      <p>Nomor : ${nomor} / ${tahun}</p>
    </div>

    <div class="isi-surat">
      <table>
        <tr>
          <td width="70px"><b>Dasar</b></td>
          <td width="10px">:</td>
          <td>${dasar}</td>
        </tr>
      </table>

      <div class="tengah"><b>MENUGASKAN</b></div>

      <table>
        <tr>
          <td width="70px"><b>Kepada</b></td>
          <td width="10px">:</td>
          <td></td>
        </tr>
      </table>
      ${petugasHTML}
      <table>
        <tr>
          <td width="70px"><b>Keperluan</b></td>
          <td width="10px">:</td>
          <td>${keperluan}</td>
        </tr>
      </table>
    </div>

    <div class="tanda-tangan">
      <p>Ditetapkan di Ngabang</p>
      <p>Pada tanggal ${tglFormat}</p>
      <p><b>CAMAT NGABANG</b></p><br><br><br>
      <p><b class="underline">YULLY NOMENSEN, S.STP</b></p>
      <p>Pembina (IV/b)</p>
      <p>NIP. 19840724 200212 1 001</p>
    </div>`;
  document.getElementById("exportButtons").style.display = "block";
}


async function exportPDF() {
  const { jsPDF } = window.jspdf;
  const element = document.getElementById("preview");

  // Render elemen dengan kualitas tinggi
  const canvas = await html2canvas(element, {
    scale: 2,
    useCORS: true,
    scrollY: 0,
    scrollX: 0,
    windowWidth: element.scrollWidth,
    windowHeight: element.scrollHeight
  });

  // Ubah hasil render ke gambar JPEG (kompres 85%)
  const imgData = canvas.toDataURL("image/jpeg", 0.85);
  const pdf = new jsPDF("p", "mm", "a4");

  // Tentukan ukuran A4 dan margin agar tidak menempel tepi
  const pageWidth = 210;
  const pageHeight = 297;
  const marginLeft = 15;  // margin kiri 1,5 cm
  const marginRight = 15; // margin kanan 1,5 cm
  const usableWidth = pageWidth - marginLeft - marginRight;
  const imgHeight = (canvas.height * usableWidth) / canvas.width;

  let heightLeft = imgHeight;
  let position = 10; // jarak dari atas halaman

  // Halaman pertama
  pdf.addImage(imgData, "JPEG", marginLeft, position, usableWidth, imgHeight, "", "FAST");
  heightLeft -= pageHeight;

  // Tambahkan halaman berikutnya jika isi lebih dari satu halaman
  while (heightLeft > 0) {
    position = heightLeft - imgHeight + 10;
    pdf.addPage();
    pdf.addImage(imgData, "JPEG", marginLeft, position, usableWidth, imgHeight, "", "FAST");
    heightLeft -= pageHeight;
  }

  pdf.save("Surat_Perintah_Tugas.pdf");
}

</script>

</body>
</html>


